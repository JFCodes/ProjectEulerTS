Module Module1

    Sub Main()
        Dim endTime As Double
        Dim starTime As Double = Timer
        Dim resposta As Integer = 0

        Dim reader As New System.IO.StreamReader("C:\Users\Joaquin\Documents\Project Euler\Sources\Problem 54.txt")

        Dim p1Hand(4) As String
        Dim p2Hand(4) As String

        Do While reader.Peek <> -1
            Dim splitLine() As String = Split(reader.ReadLine, " ")

            For i = 0 To 4
                p1Hand(i) = splitLine(i)
                p2Hand(i) = splitLine(i + 5)
            Next

            If player1Wins(p1Hand, p2Hand) Then resposta += 1

        Loop

        reader.Close()
        endTime = Timer
        Console.WriteLine("Resposta: " & resposta)
        Console.WriteLine("Excution time: " & endTime - starTime)
        Console.ReadKey()
    End Sub

    Function player1Wins(p1hand() As String, p2Hand() As String) As Boolean

        Dim p1Score(4) As Integer
        Dim p2Score(4) As Integer

        p1Score = evaluateHand(p1hand)
        p2Score = evaluateHand(p2Hand)

        If p1Score(0) > p2Score(0) Then
            Return True
        ElseIf p1Score(0) < p2Score(0) Then
            Return False
        Else
            If p1Score(1) > p2Score(1) Then
                Return True
            ElseIf p1Score(1) < p2Score(1) Then
                Return False
            Else
                If p1Score(2) > p2Score(2) Then
                    Return True
                ElseIf p1Score(2) < p2Score(2) Then
                    Return False
                Else
                    If p1Score(3) > p2Score(3) Then
                        Return True
                    ElseIf p1Score(3) < p2Score(3) Then
                        Return False
                        If p1Score(4) > p2Score(4) Then
                            Return True
                        Else
                            Return False
                        End If
                    End If
                End If
            End If
        End If
    End Function

    Function evaluateHand(hand() As String)
        Dim scoreVector(4) As Integer
        Dim handNumeric(4, 1) As Integer
        Dim numberCounter(14) As Integer
        Dim naipesCounter(4) As Integer

        For i = 0 To 4
            Select Case hand(i)(0).ToString
                Case "2"
                    handNumeric(i, 0) = 2
                Case "3"
                    handNumeric(i, 0) = 3
                Case "4"
                    handNumeric(i, 0) = 4
                Case "5"
                    handNumeric(i, 0) = 5
                Case "6"
                    handNumeric(i, 0) = 6
                Case "7"
                    handNumeric(i, 0) = 7
                Case "8"
                    handNumeric(i, 0) = 8
                Case "9"
                    handNumeric(i, 0) = 9
                Case "T"
                    handNumeric(i, 0) = 10
                Case "J"
                    handNumeric(i, 0) = 11
                Case "Q"
                    handNumeric(i, 0) = 12
                Case "K"
                    handNumeric(i, 0) = 13
                Case "A"
                    handNumeric(i, 0) = 14
            End Select

            Select Case hand(i)(1).ToString
                Case "H"
                    handNumeric(i, 1) = 1
                Case "S"
                    handNumeric(i, 1) = 2
                Case "C"
                    handNumeric(i, 1) = 3
                Case "D"
                    handNumeric(i, 1) = 4
            End Select
        Next

        For i = 0 To 4
            numberCounter(handNumeric(i, 0)) += 1
            naipesCounter(handNumeric(i, 1)) += 1
        Next
        numberCounter(1) = numberCounter(14)

        Dim hasAceSequence As Boolean = False
        Dim hasAllSameNaipe As Boolean = False
        Dim has1Pair As Boolean = False
        Dim has2Pair As Boolean = False
        Dim hasTriple As Boolean = False
        Dim hasFourKind As Boolean = False
        Dim hasSequence As Boolean = False

        For i = 1 To 4
            If naipesCounter(i) = 5 Then hasAllSameNaipe = True
        Next
        For i = 2 To 14
            If numberCounter(i) = 2 Then
                If has1Pair = False Then has1Pair = True Else has2Pair = True
            End If
            If numberCounter(i) = 3 Then hasTriple = True
            If numberCounter(i) = 4 Then hasFourKind = True
        Next
        If numberCounter(14) = 1 And _
            numberCounter(13) = 1 And _
            numberCounter(13) = 1 And _
            numberCounter(13) = 1 And _
            numberCounter(13) = 1 Then
            hasAceSequence = True
        End If
        For i = 1 To 10
            If numberCounter(i) = 1 And _
            numberCounter(i + 1) = 1 And _
            numberCounter(i + 2) = 1 And _
            numberCounter(i + 3) = 1 And _
            numberCounter(i + 4) = 1 Then
                hasSequence = True
            End If
        Next

        If hasAceSequence And hasAllSameNaipe Then
            scoreVector(0) = 9
        ElseIf hasSequence And hasAllSameNaipe Then
            scoreVector(0) = 8

            '1- Highest card in sequence
            For i = 1 To 14
                If numberCounter(i) = 1 Then scoreVector(1) = i
            Next
        ElseIf hasFourKind Then
            scoreVector(0) = 7

            '1 - Four of a kind Card
            '2 - highest alone card
            For i = 1 To 14
                If numberCounter(i) = 4 Then scoreVector(1) = i
                If numberCounter(i) = 1 Then scoreVector(2) = i
            Next
        ElseIf hasTriple And has1Pair Then
            scoreVector(0) = 6

            '1 Triple card
            '2 Highest alone card
            '3 2nd highest alone card
            For i = 14 To 1 Step -1
                If numberCounter(i) = 3 Then scoreVector(1) = i
                If numberCounter(i) = 1 And scoreVector(2) = 0 Then
                    scoreVector(2) = i
                ElseIf numberCounter(i) = 1 And scoreVector(3) = 0 Then
                    scoreVector(3) = i
                End If
            Next
        ElseIf hasAllSameNaipe Then
            scoreVector(0) = 5

            '1 Highest Card
            '2 - 2nd highest card 
            '3 - 3rd highest card
            '4 - 4rd highest card
            For i = 14 To 1 Step -1
                If numberCounter(i) = 1 And scoreVector(1) = 0 Then
                    scoreVector(1) = i
                ElseIf numberCounter(i) = 1 And scoreVector(2) = 0 Then
                    scoreVector(2) = i
                ElseIf numberCounter(i) = 1 And scoreVector(3) = 0 Then
                    scoreVector(3) = i
                ElseIf numberCounter(i) = 1 And scoreVector(4) = 0 Then
                    scoreVector(4) = i
                End If
            Next
        ElseIf hasSequence Then
            scoreVector(0) = 4

            '1 Highest sequence card
            For i = 1 To 14
                If numberCounter(i) = 1 Then scoreVector(1) = i
                Exit For
            Next
        ElseIf hasTriple Then
            scoreVector(0) = 3

            '1 - triple card
            '2 - highest card
            '3 - second highest card
            For i = 14 To 1 Step -1
                If numberCounter(i) = 3 Then scoreVector(1) = i
                If numberCounter(i) = 1 And scoreVector(2) = 0 Then
                    scoreVector(2) = i
                ElseIf numberCounter(i) = 1 And scoreVector(3) = 0 Then
                    scoreVector(3) = i
                End If
            Next
        ElseIf has2Pair Then
            scoreVector(0) = 2

            '1 highest pair card
            '2 2nd highest pair card
            '3 highest alone card
            For i = 14 To 2 Step -1
                If numberCounter(i) = 2 And scoreVector(1) = 0 Then
                    scoreVector(1) = i
                ElseIf numberCounter(i) = 2 And scoreVector(2) = 0 Then
                    scoreVector(2) = i
                End If
                If numberCounter(i) = 1 Then scoreVector(3) = i
            Next
        ElseIf has1Pair Then
            scoreVector(0) = 1

            '1 pair card
            '2 highest alone card
            '3 2nd hiest alone card
            For i = 14 To 2 Step -1
                If numberCounter(i) = 2 Then scoreVector(1) = i
                If numberCounter(i) = 1 And scoreVector(2) = 0 Then
                    scoreVector(2) = i
                ElseIf numberCounter(i) = 1 And scoreVector(3) = 0 Then
                    scoreVector(3) = i
                End If
            Next
        Else
            scoreVector(0) = 0


            For i = 14 To 2 Step -1
                If numberCounter(i) = 1 And scoreVector(1) = 0 Then
                    scoreVector(1) = i
                ElseIf numberCounter(i) = 1 And scoreVector(2) = 0 Then
                    scoreVector(2) = i
                ElseIf numberCounter(i) = 1 And scoreVector(3) = 0 Then
                    scoreVector(3) = i
                ElseIf numberCounter(i) = 1 And scoreVector(4) = 0 Then
                    scoreVector(4) = i
                End If
            Next
        End If

        Return scoreVector
    End Function
End Module